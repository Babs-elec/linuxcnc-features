
(Add line)
O<add-line> SUB
	O<goto> CALL [#1] [#2] [1]
O<add-line> ENDSUB


(Add line)
O<goto> SUB
	#<x> =  #1
	#<y> =  #2
	#<gcode> = #3
	O<add-line-if> IF [#<_plane> EQ 170] (XY)
		G#<gcode> X#<x> Y#<y> 
	O<add-line-if> ELSEIF [#<_plane> EQ 180] (XZ)
		G#<gcode> X#<x> Z#<y>
	O<add-line-if> ELSEIF [#<_plane> EQ 190] (YZ)
		G#<gcode> Y#<x> Z#<y>
	O<add-line-if> ENDIF
O<goto> ENDSUB



(Add arc sub)
(G x y i j)
O<add-arc> SUB
	#<gcode> = #1
	#<x> =  #2
	#<y> =  #3
	#<i> =  #4
	#<j> =  #5
	O<add-arc-if> IF     [#<_plane> EQ 170] (XY)
		G#<gcode> X#<x> Y#<y> I#<i> J#<j> 
	O<add-arc-if> ELSEIF [#<_plane> EQ 180] (XZ)
		G#<gcode> X#<x> Z#<y> I#<i> K#<j> 
	O<add-arc-if> ELSEIF [#<_plane> EQ 190] (YZ)
		G#<gcode> Y#<x> Z#<y> J#<i> K#<j> 
	O<add-arc-if> ENDIF
O<add-arc> ENDSUB


(Add tangent2 arc)
(x,y,r,a,a)
O<add-tangent2-arc> SUB
	#<gcode> = #1
	#<r> =  #2
	#<a> =  #3
	#<a1> = #4

	O<get-local> CALL (get current local position)

	O<add-tangent2-arc-if-02> IF     [#<_plane> EQ 170] (XY)
		#<x0> = #<_lx>
		#<y0> = #<_ly>
	O<add-tangent2-arc-if-02> ELSEIF [#<_plane> EQ 180] (XZ)
		#<x0> = #<_lx>
		#<y0> = #<_lz>
	O<add-tangent2-arc-if-02> ELSEIF [#<_plane> EQ 190] (YZ)
		#<x0> = #<_ly>
		#<y0> = #<_lz>
	O<add-tangent2-arc-if-02> ENDIF 

	O<add-tangent2-arc-if-01> IF [#<gcode> EQ 3]
		#<i> = [ COS[#<a>]*#<r>]
		#<j> = [-SIN[#<a>]*#<r>]
		#<x1> = [ #<x0>+#<i> - COS[#<a1>]*#<r> ]
		#<y1> = [ #<y0>+#<j> + SIN[#<a1>]*#<r> ]
	O<add-tangent2-arc-if-01> ELSE
		#<i> = [-COS[#<a>]*#<r>]
		#<j> = [ SIN[#<a>]*#<r>]
		#<x1> = [ #<x0>+#<i> + COS[#<a1>]*#<r> ]
		#<y1> = [ #<y0>+#<j> - SIN[#<a1>]*#<r> ]
	O<add-tangent2-arc-if-01> ENDIF
	
	;O<goto> CALL [#<i>] [#<j>]
	;O<goto> CALL [#<x1>] [#<y1>]
	;O<goto> CALL [#<x0>] [#<y0>]
	;O<goto> CALL [#<_lx>] [#<_lz>]
	
	O<add-arc> CALL [#<gcode>] [#<x1>] [#<y1>] [#<i>] [#<j>]
	
O<add-tangent2-arc> ENDSUB

(Add tangent arc-dx)
(x,y,r,a,dx)
O<add-tangent-arc> SUB
	#<gcode> = #1
	#<r> =  #2
	#<a> =  #3
	#<x1> = #4
	#<y1> = #4
	#<dx> = #5 (What offset is used x1 or y1)

	O<add-tangent-arc-if-01> IF [#<gcode> EQ 3]
		#<i> = [ COS[#<a>]*#<r>]
		#<j> = [-SIN[#<a>]*#<r>]
	O<add-tangent-arc-if-01> ELSE
		#<i> = [-COS[#<a>]*#<r>]
		#<j> = [SIN[#<a>]*#<r>]
	O<add-tangent-arc-if-01> ENDIF

	O<get-local> CALL (get current local position)

	O<add-tangent-arc-if-02> IF     [#<_plane> EQ 170] (XY)
		#<x0> = #<_lx>
		#<y0> = #<_ly>
	O<add-tangent-arc-if-02> ELSEIF [#<_plane> EQ 180] (XZ)
		#<x0> = #<_lx>
		#<y0> = #<_lz>
	O<add-tangent-arc-if-02> ELSEIF [#<_plane> EQ 190] (YZ)
		#<x0> = #<_ly>
		#<y0> = #<_lz>
	O<add-tangent-arc-if-02> ENDIF 
	
	O<goto> CALL [#<i>] [#<j>]
	O<goto> CALL [#<x0>] [#<y0>]
	#<cx> = [#<x0> + #<i>] 
	#<cy> = [#<y0> + #<j>]
	O<add-tangent-arc-paranoid> IF [#<_paranoid> GT 0] (We are paranoid Will raise an error while preview if we can not add arc)
		O<add-tangent-arc-if-03> IF [#<dx> EQ 0]
			#<y1> = [ SQRT[ #<r>*#<r> - [#<x1>-#<cx>]*[#<x1>-#<cx>] ] + #<cy> ]	
		O<add-tangent-arc-if-03> ELSE 
			#<x1> = [ SQRT[ #<r>*#<r> - [#<y1>-#<cy>]*[#<y1>-#<cy>] ] + #<cx> ]	
		O<add-tangent-arc-if-03> ENDIF 
		O<add-arc> CALL [#<gcode>] [#<x1>] [#<y1>] [#<i>] [#<j>]		

	O<add-tangent-arc-paranoid> ELSE (We are not paranoid)
		O<add-tangent-arc-if-04> IF [#<dx> EQ 0]
			(DEBUG, Tada)
			#<y1> = [ #<r>*#<r> - [#<x1>-#<cx>]*[#<x1>-#<cx>] ]
			O<add-tangent-arc-if-05> IF [ #<y1> GT 0 ]
				#<y1> = [-SQRT[#<y1>] + #<cy>]
				O<add-arc> CALL [#<gcode>] [#<x1>] [#<y1>] [#<i>] [#<j>]	
			O<add-tangent-arc-if-05> ELSE 
				O<add-line> CALL [#<x1>] [#<y0>] (we are not paranoid - just add a line)
			O<add-tangent-arc-if-05> ENDIF 

		O<add-tangent-arc-if-04> ELSE (dy)

			#<x1> = [ #<r>*#<r> - [#<y1>-#<cy>]*[#<y1>-#<cy>] ]
			O<add-tangent-arc-if-06> IF [ #<x1> GT 0 ]
				#<x1> = [-SQRT[#<x1>] + #<cx>]
				O<add-arc> CALL [#<gcode>] [#<x1>] [#<y1>] [#<i>] [#<j>]	
			O<add-tangent-arc-if-06> ELSE 
				O<add-line> CALL [#<x0>] [#<y1>] (we are not paranoid - just add a line)
			O<add-tangent-arc-if-06> ENDIF 

		O<add-tangent-arc-if-04> ENDIF (dx/dy)
		
	O<add-tangent-arc-paranoid> ENDIF 
	 
O<add-tangent-arc> ENDSUB 




