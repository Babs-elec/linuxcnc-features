

(This sub uses get-offsets.ngc, do not forget to include <eval>self.include_once["get-offsets.ngc"]</eval>)
(get alpha at the end of next move)

#<_global_alpha_at_move_end> =  0
O<alpha_at_move_end> SUB
	#<gcode> = #1
	#<x> = #2
	#<z> = #3
	#<i> = #4
	#<k> = #5
	#<r> = #6
	
	(Get all parameters in absolute coordinates)
	O<alpha_at_move_end-if-0001> IF [#<_absolute>]
		O<get-offsets> CALL 
		#<x> = [#<x> + #<_get_offsets_x>]
		#<z> = [#<z> + #<_get_offsets_z>]
	O<alpha_at_move_end-if-0001> ELSE 
		#<x> = [#<x>+#<_x>]
		#<z> = [#<z>+#<_z>]
	O<alpha_at_move_end-if-0001> ENDIF 
	
	O<alpha_at_move_end-if-0002> IF [#<_ijk_absolute_mode>]
		#<i> = [#<i> + #<_get_offsets_x>]
		#<k> = [#<k> + #<_get_offsets_z>]
	O<alpha_at_move_end-if-0002> ELSE
		#<i> = [#<i>+#<_x>]
		#<k> = [#<k>+#<_z>]
	O<alpha_at_move_end-if-0002> ENDIF
	
	(Now get alpha)
	O<alpha_at_move_end-if> IF [#<gcode> EQ 1] 
		(it's a line)
		#<_global_alpha_at_move_end> =  ATAN[#<x>-#<_x>]/[#<z>-#<_z>]
		(DEBUG, #<_global_alpha_at_move_end>)
	O<alpha_at_move_end-if> ELSEIF [#<gcode> EQ 2]
		(alpha = atan of the vector center-end_point ratated to -+90 degree i.e. [-x/z] or [x/z]) 
		#<_global_alpha_at_move_end> =  ATAN[#<x>-#<i>]/[#<z>-#<k>]
	O<alpha_at_move_end-if> ELSEIF [#<gcode> EQ 2]
		(--"--)
		#<_global_alpha_at_move_end> =  ATAN[-[#<x>-#<i>]]/[#<z>-#<k>]
	O<alpha_at_move_end-if> ENDIF
	
O<alpha_at_move_end> ENDSUB
